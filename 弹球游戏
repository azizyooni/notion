<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Matter-JS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.12.0/matter.js"></script>
 
</head>
<body>
<script type="text/javascript"></script>
<script>
    var Engine = Matter.Engine;//引擎.引擎模块包含创建和操作引擎的方法
    var Render = Matter.Render;//基于HTML5画布的渲染器
    var World = Matter.World;//演出舞台. Matter.js 中任何的物体都需要一个舞台/容器，而存放这些物体的地方，则称之为World(世界)
    var Bodies = Matter.Bodies;//用于创建各种形状的物体，物体必须添加到Wolrd中，然后由引擎运行世界
 
    var engine = Engine.create();
    //render(渲染器)将要渲染的物理引擎是上面的engine，而渲染的对象是html网页的body
    var render = Render.create({
        element: document.body, 
        engine: engine,
    options:{
        width:1600,
        height:800,
        wireframes:false
    }});
 
    /**
     * Bodies.rectangle = function(x, y, width, height, options)
     * x,y 分别表示矩形中心点的坐标，坐标的原点(0,0)在 Canvas(画布)的左上角
     * width,height 分别表示矩形的宽和高
     * options：描述矩形的参数，是一个 json 对象
     * @type {body}
     */
    
    //将isStatic设为true，表示物体静止
    var ground = Bodies.rectangle(1200, 500, 310, 20, {isStatic: true});
    World.add(engine.world, [ground]);// 将所有物体添加到世界中

    let mouse = Matter.Mouse.create(render.canvas);//添加鼠标移动功能
    let mouseConstraint = Matter.MouseConstraint.create(engine, {mouse: mouse,constraint: {render: {visible: true}}});//visible：ture能显示鼠标点击的部位
    render.mouse = mouse;

    let ball = Matter.Bodies.circle(400, 600,20);
let sling = Matter.Constraint.create({ 
      pointA: { x: 400, y: 600 }, 
      bodyB: ball, 
      stiffness: 0.05
  });
    let stack = Matter.Composites.stack(1100,270,4,4,0,0, function(x,y){
        let sides=Math.round(Matter.Common.random(2,8));
  return Matter.Bodies.polygon(x,y,8,30);
});
let firing = false;
Matter.Events.on(mouseConstraint,'enddrag', function(e) {
  if(e.body === ball) firing = true;
});
Matter.Events.on(engine,'afterUpdate', function() {
  if (firing && Math.abs(ball.position.x-400) < 20 && Math.abs(ball.position.y-600) < 20) {
      ball = Matter.Bodies.circle(400, 600, 20);
      Matter.World.add(engine.world, ball);
      sling.bodyB = ball;
      firing = false;
  }
});
    Matter.World.add(engine.world,[stack,ground,ball,sling,mouseConstraint]);







    Engine.run(engine);//运行引擎
    Render.run(render);//运行渲染器
</script>
</body>
</html>
